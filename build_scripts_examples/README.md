<p align="left">
  <img class="liquibase_hdr_logo_img" src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22162%22%20height%3D%2236%22%20fill%3D%22none%22%3E%3Cpath%20d%3D%22M31.521%204.871v20.823h12.227v-4.06h-7.785V9.266c0-2.388-2.006-4.394-4.442-4.394zm18.818%206.641h-4.251v14.184h4.25V11.512zM81%2019.583c0%201.385-.621%202.675-2.388%202.675-1.624%200-2.197-1.242-2.197-2.627v-8.12h-4.25v9.314c0%203.009%201.862%205.253%204.966%205.253%201.528%200%203.057-.62%204.06-2.053v1.719h4.011V11.56h-4.25v8.023H81zm12.227-8.071h-4.25v14.184h4.25V11.512zm46.995%205.395l-1.146-.239c-1.242-.286-1.767-.525-1.767-1.242%200-.716.717-1.003%201.576-1.003.812%200%201.624.24%201.624%201.433h4.298c-.238-3.2-2.674-4.68-5.922-4.68-3.247%200-5.922%201.624-5.922%204.537s2.197%203.868%204.728%204.394l1.385.286c1.051.24%201.624.526%201.624%201.29%200%20.812-.716%201.194-1.767%201.194-1.099%200-1.958-.478-1.958-1.767h-4.442c.191%203.534%202.866%204.967%206.543%204.967%203.439%200%206.066-1.576%206.066-4.776-.048-2.818-2.149-3.773-4.92-4.394zm10.985%200c.525-1.385%201.671-2.293%203.343-2.293%201.671%200%202.865.86%203.295%202.293h-6.638zM162%2018.435c0-4.06-2.817-7.26-7.402-7.26-4.394%200-7.594%203.344-7.594%207.451%200%204.108%203.009%207.45%207.546%207.45%203.773%200%206.352-1.957%207.212-4.966h-4.108c-.621%201.05-1.576%201.576-3.056%201.576-1.911%200-3.2-1.194-3.535-2.961H162v-1.29zm-40.118%204.059a3.78%203.78%200%2001-3.773-3.773%203.781%203.781%200%20013.773-3.773%203.78%203.78%200%20013.773%203.773c-.048%202.101-1.719%203.773-3.773%203.773zm3.916-10.173c-1.146-.716-2.483-1.098-3.916-1.098-4.155%200-7.546%203.39-7.546%207.546%200%204.155%203.391%207.546%207.546%207.546%201.433%200%202.77-.382%203.916-1.099v.525h4.06V11.557h-4.06v.764zM104.88%2022.495a3.78%203.78%200%2001-3.773-3.773%203.781%203.781%200%20013.773-3.773%203.78%203.78%200%20013.773%203.773%203.78%203.78%200%2001-3.773%203.773zm.478-11.27a7.548%207.548%200%2000-4.394%201.098v-5.35a4.056%204.056%200%2000-4.06-4.059v22.781h4.06v-.525c1.146.716%202.483%201.098%203.916%201.098%204.346%200%207.833-3.677%207.498-8.07-.238-3.726-3.295-6.735-7.02-6.974zM48.189%204.871a2.466%202.466%200%2000-2.484%202.484%202.466%202.466%200%20002.484%202.483%202.467%202.467%200%20002.483-2.483c0-1.338-1.098-2.484-2.483-2.484zm42.888%200a2.466%202.466%200%2000-2.483%202.484%202.466%202.466%200%20002.483%202.483%202.467%202.467%200%20002.484-2.483c0-1.338-1.099-2.484-2.484-2.484zM60.799%2022.495a3.781%203.781%200%2001-3.773-3.773%203.78%203.78%200%20013.773-3.773%203.78%203.78%200%20013.773%203.773%203.78%203.78%200%2001-3.773%203.773zm3.868-10.984v.86a7.468%207.468%200%2000-4.442-1.147c-3.773.239-6.83%203.248-7.068%206.973-.286%204.394%203.2%208.071%207.498%208.071a7.622%207.622%200%20003.726-1.003v6.018a4.26%204.26%200%20004.25%204.25V11.512h-3.964zM10.84%200c6.352%200%2010.794%202.292%2010.794%204.346%200%202.054-4.442%204.346-10.793%204.346C4.489%208.692.046%206.4.046%204.346.047%202.292%204.44%200%2010.84%200zm.24%2023.402c-3.438.812-7.02%201.672-9.313%203.2C.621%2025.886%200%2025.074%200%2024.309c0-3.438%205.731-4.728%2011.271-5.97%204.012-.907%208.072-1.814%2010.364-3.677v3.009c0%203.2-5.349%204.49-10.555%205.731zm-.19-6.877c-4.204.955-8.502%201.91-10.89%203.964v-.669c0-5.97%206.543-7.498%2012.895-8.978%204.585-1.099%206.83-1.624%208.74-3.153v3.344c0%203.056-5.492%204.298-10.746%205.492zm10.745%204.871c-2.245%201.91-6.257%202.866-10.125%203.773-2.818.67-5.684%201.338-7.69%202.34%201.815.67%204.25%201.1%207.021%201.1%206.304%200%2010.794-2.246%2010.794-4.347v-2.866z%22%20fill%3D%22%232962FF%22%2F%3E%3C%2Fsvg%3E" alt="Liquibase Logo" title="Liquibase Logo" width="324" height="72">
</p>

This repository contains working examples of Liquibase running with various automation tools.

# Updated Examples

| Automation Tool |
|----------|
| [Azure DevOps](ADO/azure_pipelines_docker.yml)|
| [Bitbucket](Bitbucket/bitbucket-pipelines.yml) |
| [CircleCI](CircleCI/config.yml) |
| [CodeBuild (Amazon Web Services)](CodeBuild/buildspec.yml) |
| [GitHub Actions](GitHub_Actions/liquibase_workflow.yml) |
| [GitLab](GitLab_CICD_Pipelines/gitlab-ci.yml) |
| [Jenkins](Jenkins/Jenkinsfile) |

# Methodology
Each pipeline will perform the following steps:
1. Checkout source code repository
1. Execute Liquibase flow via Docker
1. Update source code respository with the new Snapshot file (used for drift detection)

Note for some pipelines, a personal access token was used to provide read/write access to the repository (e.g., GitHub Actions). The repository and access will have to be updated prior to use in your environment.

# Assumptions
* Pipelines must be reviewed and updated prior to use
* Pro-only features utilized
* Docker container utilized (https://hub.docker.com/r/liquibase/liquibase)
* Git based repository utilized
* Local agents/runners utilized where noted
* Required environment variables defined in configuration file or pipeline itself
* Credentials pulled from secure location

# Required Environment Variables
The following environment variables must be defined and passed in to the Liquibase Docker container. If running Liquibase locally, these need to be set prior to invocation.
| Variable | Secret | Description |
|----------|   :---:   |------------|
| LB_ENVIRONMENT | | The environment the pipeline is running against (e.g., DEV, TEST, PROD). By default, diff and snapshot files are created with this variable in the name.
| LIQUIBASE_COMMAND_CHANGELOG_FILE | | The changelog file to process. Typically, a main file is invoked which calls other changelog files. https://docs.liquibase.com/concepts/changelogs/home.html
| LIQUIBASE_COMMAND_TAG | | A unique identifier to tag the database. By default, the pipeline build/job number is used.
| LIQUIBASE_COMMAND_URL | x | The JDBC URL of the target database.
| LIQUIBASE_COMMAND_USERNAME | x | The user ID for the target database.
| LIQUIBASE_COMMAND_PASSWORD | x | The user password for the target database.
| LIQUIBASE_PRO_LICENSE_KEY | x | A valid Liquibase Pro license key.

# Required Files
The following files must be located in the source code repository for these pipelines to execute successfully.
| File name | Description | Documentation
|----------|------------|-------------|
| changelog.main.xml | Main changelog file | https://docs.liquibase.com/concepts/changelogs/home.html
| liquibase.flowfile.yaml | Flow file | https://docs.liquibase.com/commands/flow/flow.html
| liquibase.checks-settings.conf | Quality checks configuration | https://docs.liquibase.com/commands/quality-checks/home.html
| Snapshot_DEV.json | Initial snapshot file | https://docs.liquibase.com/commands/inspection/snapshot.html

To create the initial quality checks file:
```
liquibase checks show
```
To create the initial snapshot file:
```
liquibase snapshot --outputfile="Snapshot_DEV.json" --snapshotformat=json
```

# Contact Liquibase
#### Liquibase sales: https://www.liquibase.com/contact
#### Liquibase support: https://support.liquibase.com/knowledge